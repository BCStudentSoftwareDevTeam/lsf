{% extends "base.html" %}

{% block styles %}
{{super()}}
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/jq-3.3.1/dt-1.10.18/r-2.2.2/datatables.min.css"/>
  <link href="https://cdn.datatables.net/buttons/1.5.6/css/buttons.dataTables.min.css"rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="{{url_for('static', filename ='css/index.css')}}?u={{lastStaticUpdate}}">
{% endblock %}

{% block scripts %}
{{super()}}
  <script type="text/javascript" src="https://cdn.datatables.net/v/bs/jq-3.3.1/dt-1.10.18/r-2.2.2/datatables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.5.4/bootstrap-select.js"></script>
  <script type="text/javascript" src="{{url_for('static', filename='js/index.js') }}?u={{lastStaticUpdate}}"></script>
  <script>
    var tableTabs = {{tableTabs|safe}};
  </script>
{% endblock %}

{% block app_content %}
<!-- header -->
<a class="skipContent" href="#download" tabindex="1">Click to Skip</a>
<div align="center">
  <h1>Supervisor Portal</h1>
  <span id="portalTitle" >Current Students</span>
</div>

<!-- This section of Div tags is used to keep the formatting for when we show
and hide the department select picker. -->
<div class="col-md-5"></div>
<div class="col-md-2" id="placeholder"></div>

<div class="col-md-2" align="center" id="userDepartments">
  <select class="selectpicker"
          id="departmentDropDown"
          onchange="populateTable()"
          title="Department"
          data-width="100%">
    {% for formHistory in currentUserDepartments %}
        <!-- We want to either select the first option, or the option that matches the department -->
        {% if loop.index == 1 or formHistory.formID.department.DEPT_NAME == department %}
          <option value="{{formHistory.formID.department.DEPT_NAME}}"
                  selected>{{formHistory.formID.department.DEPT_NAME}}
          </option>
        {% else %}
          <option value="{{formHistory.formID.department.DEPT_NAME}}">
                        {{formHistory.formID.department.DEPT_NAME}}
          </option>
        {% endif %}
    {% endfor %}
  </select>
</div>

<div class="col-md-3" align= "right">
  <button class="btn btn-success"
          id="download"
          data-toggle="modal"
          data-target="#downloadModal"
          style="display:None">Download
  </button>
</div>
<div class="col-md-2"></div>

<!-- start of Download modal -->
<form target="frame" method="POST">
 <div class="modal fade" id="downloadModal" role="dialog" tabindex="-1">
   <div class="modal-dialog">
     <div class="modal-content" align="center">
       <div class="modal-header" align="center">
         <h4 class="modal-title">Please select what you would like to download.</h4>
       </div>
       <div class="col-md-3"></div>
       <div class="col-md-9 modal-body" align="left">
         <div id="downloadModalText">
           <label id = "selectAllLabel">
              <input type="checkbox"
                    name="student"
                    id="selectAll">
              <strong>Select all</strong>
            </label>
        </div>
       </div>
       <div class="modal-footer" align="center">
         <button  class="btn btn-danger"
                  id="closeButton"
                  onclick="downloadHistory()"
                  data-dismiss="modal">Close
        </button>
         <button type="submit"
                  value="Submit"
                  class="btn btn-success"
                  id="modal">Download
        </button>
       </div>
     </div>
   </div>
  </div>
</form>
<!-- end of Download modal-->

<!-- Start of data-table that will display the supervisees -->
<div class="col-md-3"></div>
<div class="col-md-7" align="center" >
  <table id="studentList"
        class="table table-striped studentTable"
        style="display:none">
    <!-- Made empty header tags because we need to hide the header -->
    <thead>
      <tr>
        <th> </th>
        <th> </th>
      </tr>
    </thead>

    {%- for form in currentSupervisees %}
      <tr>
        <td>
          <div class="row">
            <a href="/laborHistory/{{form.formID.studentSupervisee.ID}}" value=0>
              <span class="h4">{{form.formID.studentSupervisee.FIRST_NAME}} {{form.formID.studentSupervisee.LAST_NAME}}
                              ({{form.formID.studentSupervisee.ID}}) </span>
                              <span class="h6"> ({{form.formID.jobType[0]}}) {{form.formID.POSN_TITLE}}</span>

            </a>
            <span class="pushRight h5">{{form.status}}</span>
          </div>
          <div class="row">
            <span class="pushLeft h6"> {{form.formID.termCode.termName}}</span>
            <span class="pushRight h6">{{form.formID.department.DEPT_NAME}}</span>
          </div>
        </td>
        <td style="display:none">
          <span>{{form.status}}, {{form.formID.termCode.termName}}</span>
          <span id="hiddenStudentName">{{form.formID.studentSupervisee.FIRST_NAME}} {{form.formID.studentSupervisee.LAST_NAME}}</span>
          <span id="hiddenBnumber">{{form.formID.studentSupervisee.ID}}</span>
        </td>
      </tr>
    {% endfor -%}

    {# This populates the last tab (Past) #}
    {%- for form in pastSupervisees %}
      <tr>
        <td>
          <div class="row">
            <a href="/laborHistory/{{form.formID.studentSupervisee.ID}}" value=0>
              <span class="h4">{{-form.formID.studentSupervisee.FIRST_NAME}} {{form.formID.studentSupervisee.LAST_NAME-}}
                              ({{form.formID.studentSupervisee.ID}}) </span>
                              <span class="h6"> ({{form.formID.jobType[0]}}) {{form.formID.POSN_TITLE}}</span>
            </a>
            <span class="pushRight h5">Past Student</span>
          </div>
          <div class="row">
            <span class="pushLeft h6"> {{form.formID.termCode.termName}}</span>
            <span class="h6"> - (Ended {{form.formID.endDate.strftime('%m/%d/%Y')}})</span>
            <span class="pushRight h6">{{form.formID.department.DEPT_NAME}}</span>
          </div>
        </td>
        <td style="display:none">
          <span>Past, {{form.formID.termCode.termName}}</span>
          <span id="hiddenStudentName">{{form.formID.studentSupervisee.FIRST_NAME}} {{form.formID.studentSupervisee.LAST_NAME}}</span>
          <span id="hiddenBnumber">{{form.formID.studentSupervisee.ID}}</span>
        </td>
      </tr>
    {% endfor -%}
  </table>
</div>
<div class="col-md-2"></div>
<!-- End of data-table that will display the supervisee -->
<!-- Keeps modal form closing when submit( Download ) button is pressed -->
<iframe name="frame"></iframe>
{% endblock %}
